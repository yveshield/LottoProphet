# 更新内容概览

---

## 1. **修复数据预处理问题**
- **红球和蓝球维度问题**：
  - **之前问题**：`red_labels` 和 `blue_labels` 的维度和模型输入/输出不匹配，导致训练时报错。
  - **更新**：在 `preprocess` 函数中，为红球标签和蓝球标签进行了序列填充，使其与 `WINDOW_SIZE` 一致：
    - 红球标签用 `np.pad` 填充为序列长度，未使用部分填充为 `-1`，以便在计算损失时忽略。
    - 蓝球标签用 `np.full` 填充为序列长度，解决了蓝球训练维度不匹配的问题。

---

## 2. **优化 `preprocess` 函数**
- **添加了数据列数校验**：
  - **目的**：确保输入数据格式正确（至少需要 6 列红球和 1 列蓝球）。
  - **具体实现**：检查 `data.columns` 的列数是否达到预期值，若不足则抛出 `ValueError`。
- 使用 `torch.tensor` 转换时，增加了对 `numpy` 的批量转换：
  - **之前问题**：逐个 `numpy` 数组转 `torch.tensor`，导致性能较低。
  - **更新**：建议使用 `np.array` 先转换为单一 `numpy` 数组，再转为 `torch.tensor`，提升性能。

---

## 3. **更新模型定义**
- **LstmCRFModel**：
  - **之前问题**：模型定义中没有明确处理序列填充值，导致红球的部分填充值被纳入损失计算。
  - **更新**：模型中添加了序列掩码 (`mask`)，确保计算损失时忽略红球序列中填充值 `-1` 的部分。

---

## 4. **修复蓝球训练逻辑**
- **之前问题**：蓝球标签的维度和 `CRF` 层的输入不匹配，导致训练失败。
- **更新**：
  - 蓝球标签扩展为与 `WINDOW_SIZE` 一致的序列长度。
  - 为蓝球设置了全有效的序列掩码 (`blue_mask`)，确保 CRF 损失计算无误。

---

## 5. **统一代码风格**
- **变量命名**：使用统一的驼峰式命名。
- **注释规范**：对每个函数和核心代码段添加了简明注释，便于理解。
- **日志输出**：日志更清晰地记录了每个阶段的状态和数据维度，便于排查问题。

---

## 6. **修复 `ValueError` 问题**
- **之前问题**：训练蓝球时，`emissions` 和 `labels` 的维度不匹配。
- **更新**：
  - 修复了 `emissions`（模型输出）和 `labels`（真实标签）的维度对齐问题。
  - 通过调整蓝球标签的生成逻辑，确保其维度与模型输出对齐。


